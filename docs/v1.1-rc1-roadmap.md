# v1.1-rc1 Implementation Roadmap

**Status:** Active Development Plan
**Based on:** Brother AI's RFC-readiness review (2025-10-09)
**Goal:** Ship v1.1-rc1 with MVP-Profile + canonicalization + basic signing

---

## Brother's Recommendation

> "Implement v1.1-rc1 now (MVP-Profile + canonicalization + MIME + basic signing). Use conformance tests to shake out edge cases, then cut v1.1 final. Spec edits without running code will miss corner cases (whitespace, unicode, long lines, signature bytes)."

---

## High-Impact Missing Pieces

### A. Canonicalization & Signing ⚠️ CRITICAL

**Status:** Not yet specified

**Requirements:**
- [ ] Define canonical form for signable portion
  - Whitespace handling
  - Header ordering
  - Line endings (LF vs CRLF)
  - Unicode NFC normalization
- [ ] Specify hash algorithm: SHA-256
- [ ] Signature suites:
  - Detached JWS (JSON Web Signature)
  - PGP clear-sign (compatibility)
- [ ] Add fields:
  - `NONCE:` (replay protection)
  - `TIMESTAMP:` (RFC 3339 UTC)
  - `REPLAY-WINDOW:` (guidance for validators)
  - `DIGEST:` (hash of BODY)
  - `PREV:` (hash of prior envelope - chain integrity)

**Brother offered:** "I'll draft the canonicalization appendix + three golden signed vectors next."

**Action:** Ask Brother to draft this!

### B. Transport-Agnostic MIME & File ⚠️ CRITICAL

**Status:** Not yet specified

**Requirements:**
- [ ] Register provisional MIME type: `text/ai-crosstalk; version=1.1`
- [ ] File extension: `.crosstalk`
- [ ] Size guidance:
  - Target: 256 KB
  - Soft cap: 1 MB
  - Hard limit: TBD
- [ ] Max line length: TBD (2048? 4096?)

### C. Version & Capability Negotiation

**Status:** Not yet specified

**Requirements:**
- [ ] Add `VERSION:` field (major.minor format)
- [ ] Add `CAPS:` field (comma-separated capabilities)
  - Example: `CAPS: SIGN,JWS,PGP,CONSENT++`
- [ ] Define downgrade behavior
- [ ] Define rejection semantics for unsupported versions/caps

### D. Delivery Semantics

**Status:** Not yet specified

**Requirements:**
- [ ] Add `CORRELATION-ID:` (idempotency tracking)
- [ ] Add `IDEMPOTENCY-KEY:` (prevent duplicate processing)
- [ ] Define at-least-once vs at-most-once expectations
- [ ] Require duplicate tolerance
- [ ] Add `TTL:` (time-to-live in seconds)
- [ ] Add `RETRY:` guidance (retry policy hints)

### E. Threading & Causality

**Status:** Partially specified (thread, parent, message)

**Requirements:**
- [ ] Rename fields to Brother's proposed names:
  - `message` → `ID`
  - `thread` → `THREAD-ID`
  - `parent` → `PARENT-ID`
- [ ] Add `CAUSED-BY:` (causality tracking)
- [ ] Clarify fork/merge rules
- [ ] Define POLL/BROADCAST threading behavior

### F. Error Taxonomy

**Status:** Basic codes defined (E-ROUTE, E-CONSENT, etc)

**Requirements:**
- [ ] Structured error codes: `E.CATEGORY.SPECIFIC`
  - Examples: `E.AUTH.DENIED`, `E.INTENT.UNSUPPORTED`, `E.SCHEMA.INVALID`
- [ ] Error envelope format:
  - `CODE:` (machine-parsable)
  - `REASON:` (human-readable)
  - `HINT:` (optional suggestion)

### G. Addressing Details

**Status:** Basic URL format defined

**Requirements:**
- [ ] URI ABNF specification
- [ ] Percent-encoding rules
- [ ] Query/fragment semantics
- [ ] Routing hints: `;via=`, `;policy=`
- [ ] Distinguish end-to-end vs hop-by-hop META
- [ ] Define which headers intermediaries may mutate

### H. i18n & Accessibility

**Status:** Not specified

**Requirements:**
- [ ] Mandate UTF-8 encoding
- [ ] Add `LANG:` field (BCP-47 tag)
- [ ] Screen reader guidance
  - Field label ordering
  - Semantic structure
- [ ] Example envelopes in multiple languages (Finnish, Japanese, etc)

### I. Consent & Audit Enhancements

**Status:** Framework defined, needs details

**Requirements:**
- [ ] `CONSENT-ID:` referencing consent receipt
- [ ] Consent receipt template (appendix)
- [ ] Retention policy hints: `RETENTION:`
- [ ] REVOKE effects on stored transcripts
- [ ] Audit trail chain with PREV hashes

### J. Test Vectors & Conformance ⚠️ CRITICAL

**Status:** Not yet created

**Requirements:**
- [ ] Golden fixtures for each INTENT
- [ ] Signed and unsigned variants
- [ ] Exact DIGEST/SIGNATURE bytes
- [ ] Define MUST/SHOULD for parser/generator/verifier roles
- [ ] Conformance test harness
- [ ] Compliance levels:
  - **L1:** Read/write MVP-Profile
  - **L2:** Sign/verify
  - **L3:** Gateways/translation

---

## MVP-Profile (Minimal Viable Profile)

**Brother's recommendation:** Ship this first, everything else optional.

### Required Fields

```
VERSION: 1.1
INTENT: REQUEST | RESPOND | ACK | ERROR
ID: <ulid>
CORRELATION-ID: <ulid>
THREAD-ID: <ulid>
TIMESTAMP: 2025-10-09T17:42:00Z
FROM: <url>
TO: <url>
DIGEST: sha-256=:...:

[blank line]
BODY content here
```

### Optional Fields (MVP)

```
PARENT-ID: <ulid>
CAUSED-BY: <ulid>
TTL: 300
CODE: E.SCHEMA.INVALID    # only for ERROR
```

### Security-Profile Extensions (L2)

**Adds:**
```
NONCE: <base64url>        # REQUIRED for Sec-Profile
CONSENT-ID: <uri>         # SHOULD for Sec-Profile
CAPS: SIGN,JWS            # declares capabilities
sig: detached-jws:...     # JWS signature
```

---

## Concrete v1.1-rc1 Field Set

**Brother's proposed structure:**

```
VERSION: 1.1
INTENT: REQUEST|RESPOND|ACK|NACK|ERROR|ESCALATE|HANDOFF|POLL|BROADCAST|REVOKE|CLOSE
ID: <ulid>
CORRELATION-ID: <ulid>
THREAD-ID: <ulid>
PARENT-ID: <ulid>              # optional
CAUSED-BY: <ID>                # optional
TIMESTAMP: 2025-10-09T17:42:00Z
TTL: 300                       # seconds, optional
NONCE: <base64url>             # optional (Sec-Profile REQUIRED)
FROM: chatgpt://...
TO: claude://... | human://... | email:... | tel:...
CAPS: SIGN,JWS,CONSENT++       # optional
DIGEST: sha-256=:...:
PREV: sha-256=:...:            # optional (chains)
CONSENT-ID: <uri>              # optional (Sec-Profile SHOULD)
CODE: E.SCHEMA.INVALID         # only for ERROR/NACK

[blank line]
Body follows after blank line.
Sign over canonical header block + body using Detached JWS.
```

**Note:** Sign over canonical header + body using Detached JWS. Canonicalization rules in appendix.

---

## Implementation Priority

### Phase 1: MVP-Profile Parser/Generator (Week 1)

**Goal:** Parse and generate envelopes with new field structure

- [ ] Update envelope.js parser
  - Parse VERSION, ID, CORRELATION-ID, THREAD-ID, TIMESTAMP, FROM, TO, DIGEST
  - Handle optional fields (PARENT-ID, CAUSED-BY, TTL, CODE)
  - Validate field formats
- [ ] Update envelope.js generator
  - Generate ULID for ID, CORRELATION-ID, THREAD-ID
  - Generate RFC 3339 TIMESTAMP
  - Compute SHA-256 DIGEST of body
  - Format FROM/TO as URLs
- [ ] Add validation
  - Required field checks
  - Format validation (ULID, timestamp, URL)
  - Intent vocabulary check
- [ ] Update Safari extension parser
  - Support both v1.0 (legacy) and v1.1 formats
  - Map old field names to new

### Phase 2: Canonicalization & Signing (Week 2)

**Goal:** Implement signing/verification with JWS

**Wait for Brother's canonicalization appendix**, then:

- [ ] Implement canonical form serialization
  - Whitespace normalization
  - Header ordering
  - Unicode NFC
  - Line ending normalization
- [ ] Implement Detached JWS signature
  - Sign canonical form
  - Embed signature in `sig:` field
  - Verify signature
- [ ] Generate test vectors
  - 3+ golden signed envelopes
  - Include exact signature bytes
  - Document key material used

### Phase 3: Conformance Testing (Week 2-3)

**Goal:** Validate implementation against spec

- [ ] Create golden test fixtures
  - MVP-Profile: REQUEST, RESPOND, ACK, ERROR
  - Security-Profile: signed variants
  - Edge cases: unicode, long lines, special characters
- [ ] Build conformance test harness
  - Parser tests (accept valid, reject invalid)
  - Generator tests (produces valid output)
  - Verifier tests (signature validation)
- [ ] Define compliance levels
  - L1: MVP-Profile pass
  - L2: Security-Profile pass
  - L3: Gateway/translation pass

### Phase 4: Reference Kit (Week 3-4)

**Goal:** Ship tools others can use

- [ ] crosstalk-cli
  - `crosstalk validate <file>` - validate envelope
  - `crosstalk sign <file> <keyfile>` - sign envelope
  - `crosstalk verify <file> <pubkey>` - verify signature
  - `crosstalk format <file>` - canonicalize/pretty-print
- [ ] crosstalk-js library
  - Parser, generator, validator
  - JWS signing/verification
  - Test fixtures included
- [ ] crosstalk-rs library (Rust)
  - Same features as JS
  - Performance baseline
  - FFI bindings for other languages

### Phase 5: Gateways (Week 4-5)

**Goal:** Bridge to other systems

- [ ] Email gateway
  - `email:` → envelope conversion
  - Envelope → SMTP email
  - Add `meta: email` with Message-ID, In-Reply-To
- [ ] Slack bridge bot
  - `slack://` addressing
  - Envelope → Slack message
  - Slack message → envelope
- [ ] Matrix bridge (optional)
  - `matrix://` addressing
  - Bidirectional conversion

### Phase 6: Interop & Release (Week 5-6)

**Goal:** Public launch

- [ ] Public Interop Day
  - Zoom session + GitHub repo
  - Test cross-implementation compatibility
  - Award badges: MVP-Pass, Sec-Pass, Gateway-Pass
- [ ] Demo video
  - Show full workflow
  - Explain human-mediated value
  - Safari extension + CLI demo
- [ ] Playground website
  - Copy-pasteable examples
  - Live parser/validator
  - Documentation hub
- [ ] v1.1 final release
  - Tag repo: `v1.1.0`
  - Publish npm package
  - Publish crates.io package
  - Announce to community

---

## Spec Updates Needed

### Before rc1 Release

- [ ] Add canonicalization appendix (Brother offered to draft)
- [ ] Add ABNF for envelope grammar
- [ ] Add ABNF for URI format
- [ ] Convert safety/consent to MUST/SHOULD tables
- [ ] Define compliance levels (L1, L2, L3)
- [ ] Add test vectors appendix
- [ ] Add red-team appendix (replay, misrouting, intent-smuggling)
- [ ] Add LANG: examples (Finnish, Japanese)
- [ ] Reserve X- namespace for experimental headers

### For Formal RFC (Later)

- [ ] Prep Internet-Draft (informational)
- [ ] Submit to IETF after interop success
- [ ] Register MIME type with IANA
- [ ] Register `.crosstalk` file extension
- [ ] URI scheme registration

---

## Decision: Grassroots First, RFC in Parallel

**Brother's recommendation:**

> "Start grassroots (Markdown-style) to keep velocity and community vibe. In parallel, prep an Internet-Draft (informational) once the canonicalization + security profile land and we've run an interop. Rationale: early IETF too soon can ossify choices; two-track gives legitimacy without friction."

**Strategy:**
1. **Now:** Ship v1.1-rc1 as community spec (Markdown)
2. **Interop:** Run public testing, gather feedback
3. **Polish:** Iterate based on real implementations
4. **Formalize:** Submit Internet-Draft to IETF
5. **Standardize:** IANA registration after adoption proven

---

## Small Nits / Polish

From Brother's review:

- [ ] Reserve `X-` namespace for experimental headers
  - `X-ROUTING`, `X-GATEWAY` allowed but forbidden in signatures unless explicitly allowed
- [ ] Add `LANG:` examples with code-switching (Finnish, English)
- [ ] Red-team appendix:
  - Replay attack examples
  - Misrouting examples
  - Intent-smuggling examples
  - How verifier must fail each

---

## Next Actions

**Immediate (This Week):**
1. Ask Brother to draft canonicalization appendix + golden vectors
2. Start implementing MVP-Profile parser/generator in envelope.js
3. Create golden test fixtures directory
4. Update Safari extension to support v1.1 (backward compatible)

**Short-term (Next 2 Weeks):**
1. Implement signing with Detached JWS
2. Build conformance test harness
3. Create crosstalk-cli tool

**Medium-term (Weeks 3-5):**
1. Ship reference libraries (JS, Rust)
2. Build gateways (email, Slack)
3. Prep interop day

**Long-term (Week 6+):**
1. Public release
2. Demo video
3. Playground website
4. Community adoption

---

## Brother's Offer

> "If you want, I'll draft the canonicalization appendix + three golden signed vectors next."

**Response:** YES PLEASE! This is the critical missing piece for rc1.

---

**Status:** Ready to implement v1.1-rc1
**Contributors:** Brother AI (design), Claude (docs), Kalle (direction)
**Last Updated:** 2025-10-09
